<div class="employee-crud-page">
  <div class="header-actions">
    <h2>Employee Management</h2>
    
    <div class="controls">
      <mat-form-field appearance="outline" class="search-box">
        <mat-label>Search Employees</mat-label>
        <input
          matInput
          [(ngModel)]="searchValue"
          (keyup.enter)="onSearch()"
          placeholder="Search by name, email"
        />
        @if (searchValue) {
          <button mat-icon-button matSuffix (click)="searchValue=''; onSearch()">
            <mat-icon>close</mat-icon>
          </button>
        }
      </mat-form-field>
    </div>
  </div>

  <!-- Status -->
  <div class="checking">
  <div class="status-summary">
    <div class="summary-card total">
      <mat-icon>people</mat-icon>
      <div class="summary-content">
        <span class="count">{{ totalCount }}</span>
        <span class="label">Total Employees</span>
      </div>
    </div>
    
    <div class="summary-card active">
      <mat-icon>check_circle</mat-icon>
      <div class="summary-content">
        <span class="count">{{ getStatusCounts().active }}</span>
        <span class="label">Active</span>
      </div>
    </div>
    
    <div class="summary-card inactive">
      <mat-icon>cancel</mat-icon>
      <div class="summary-content">
        <span class="count">{{ getStatusCounts().inactive }}</span>
        <span class="label">Inactive</span>
      </div>
    </div>
  </div>
</div>

  @if (!loading) {
    <div class="table-container">
      <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8">
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef >Name</th>
          <td mat-cell *matCellDef="let emp">
            <div class="employee-name">
              <span>{{ emp.fullName }}</span>
              @if (!emp.isActive) {
                <mat-icon class="inactive-icon" matTooltip="Inactive Employee">block</mat-icon>
              }
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef >Email</th>
          <td mat-cell *matCellDef="let emp">{{ emp.email }}</td>
        </ng-container>

        <ng-container matColumnDef="departmentName">
          <th mat-header-cell *matHeaderCellDef>Department</th>
          <td mat-cell *matCellDef="let emp">
            <span>
              {{ emp.departmentName }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="profileStatus">
          <th mat-header-cell *matHeaderCellDef>Profile Status</th>
          <td mat-cell *matCellDef="let emp">
            <span [class]="emp.isProfileCompleted ? 'status-completed' : 'status-pending'">
              {{ emp.isProfileCompleted ? 'Complete' : 'Incomplete' }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Account Status</th>
          <td mat-cell *matCellDef="let emp">
            <span [class]="emp.isActive ? 'status-active' : 'status-inactive'">
              {{ emp.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="documents">
          <th mat-header-cell *matHeaderCellDef>Documents</th>
          <td mat-cell *matCellDef="let emp">
            <span class="document-count" (click)="viewDocuments(emp)" matTooltip="View documents">
              {{ getDocumentCount(emp) }}/6
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let emp">
            <button mat-icon-button color="accent" (click)="openDialog(emp)" matTooltip="Edit">
              <mat-icon>edit</mat-icon>
            </button>
            
            @if (emp.isActive) {
              <button mat-icon-button color="warn" (click)="deactivateEmployee(emp)" matTooltip="Deactivate">
                <mat-icon>block</mat-icon>
              </button>
            } @else {
              <button mat-icon-button color="primary" (click)="activateEmployee(emp)" matTooltip="Activate">
                <mat-icon>check_circle</mat-icon>
              </button>
            }
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <!-- Empty State -->
      @if (dataSource.data.length === 0) {
        <div class="empty-state">
          <mat-icon>people_outline</mat-icon>
          <h3>No employees found</h3>
          <p>@if (searchValue) {
            No employees match your search criteria
          } @else if (viewMode === 'active') {
            No active employees found
          } @else if (viewMode === 'inactive') {
            No inactive employees found
          } @else {
            No employees found in the system
          }</p>
        </div>
      }
    </div>
  }

  <mat-paginator
    [length]="totalCount"
    [pageSize]="pageSize"
    [pageSizeOptions]="[3, 10, 20, 50]"
    (page)="onPageChange($event)"
    showFirstLastButtons>
  </mat-paginator>

  @if (loading) {
    <div class="loading-spinner">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
    </div>
  }
</div>